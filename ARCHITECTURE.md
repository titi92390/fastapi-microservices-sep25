# ğŸ—ï¸ Architecture AWS - Microservices Platform

## ğŸ“Š Vue d'ensemble

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚         Internet / Users            â”‚
                                    â”‚                                     â”‚
                                    â”‚  ğŸŒ https://api.leotest.abrdns.com  â”‚
                                    â”‚  ğŸŒ https://app.leotest.abrdns.com  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â”‚ HTTPS (443)
                                                       â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚           Route 53 (DNS)                        â”‚
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                              â”‚  â”‚  api.leotest.abrdns.com â†’ ALB           â”‚   â”‚
                              â”‚  â”‚  app.leotest.abrdns.com â†’ ALB           â”‚   â”‚
                              â”‚  â”‚  Certificate Manager (SSL/TLS)          â”‚   â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Application Load Balancer (ALB)               â”‚
                              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                              â”‚   â”‚  Listener 443 (HTTPS)          â”‚            â”‚
                              â”‚   â”‚  Listener  80 (HTTP â†’ 443)     â”‚            â”‚
                              â”‚   â”‚  Target Group: Traefik:30080   â”‚            â”‚
                              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                                                              â”‚
                â”‚                      AWS VPC (10.0.0.0/16)                                   â”‚
                â”‚  Region: eu-west-3 (Paris)                                                   â”‚
                â”‚                                                                              â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                â”‚  â”‚                    Internet Gateway                                 â”‚    â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                â”‚                           â”‚               â”‚                                 â”‚
                â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
                â”‚          â”‚   Availability Zone A  â”‚  â”‚  Availability Zone Bâ”‚                â”‚
                â”‚          â”‚   (eu-west-3a)         â”‚  â”‚  (eu-west-3b)       â”‚                â”‚
                â”‚          â”‚                        â”‚  â”‚                     â”‚                â”‚
                â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                â”‚
                â”‚          â”‚  â”‚  Public Subnet   â”‚ â”‚  â”‚ â”‚  Public Subnet   â”‚â”‚                â”‚
                â”‚          â”‚  â”‚  10.0.1.0/24     â”‚ â”‚  â”‚ â”‚  10.0.10.0/24    â”‚â”‚                â”‚
                â”‚          â”‚  â”‚                  â”‚ â”‚  â”‚ â”‚                  â”‚â”‚                â”‚
                â”‚          â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚                â”‚
                â”‚          â”‚  â”‚  â”‚NAT Gateway â”‚ â”‚ â”‚  â”‚ â”‚  â”‚NAT Gateway â”‚  â”‚â”‚                â”‚
                â”‚          â”‚  â”‚  â”‚    (EIP)   â”‚ â”‚ â”‚  â”‚ â”‚  â”‚    (EIP)   â”‚  â”‚â”‚                â”‚
                â”‚          â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚                â”‚
                â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                â”‚
                â”‚          â”‚           â”‚          â”‚  â”‚          â”‚          â”‚                â”‚
                â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                â”‚
                â”‚          â”‚  â”‚ Private Subnet  â”‚ â”‚  â”‚ â”‚ Private Subnet   â”‚â”‚                â”‚
                â”‚          â”‚  â”‚  EKS Nodes      â”‚ â”‚  â”‚ â”‚  EKS Nodes       â”‚â”‚                â”‚
                â”‚          â”‚  â”‚  10.0.2.0/24    â”‚ â”‚  â”‚ â”‚  10.0.20.0/24    â”‚â”‚                â”‚
                â”‚          â”‚  â”‚                 â”‚ â”‚  â”‚ â”‚                  â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚EKS Node     â”‚ â”‚ â”‚  â”‚ â”‚ â”‚EKS Node      â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚t3.medium    â”‚ â”‚ â”‚  â”‚ â”‚ â”‚t3.medium     â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚             â”‚ â”‚ â”‚  â”‚ â”‚ â”‚              â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”‚Traefik  â”‚ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”‚Traefik   â”‚ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”‚NodePort â”‚ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”‚NodePort  â”‚ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”‚  30080  â”‚ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”‚  30080   â”‚ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚      â”‚      â”‚ â”‚ â”‚  â”‚ â”‚ â”‚      â”‚       â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”‚Pods     â”‚ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”‚Pods      â”‚ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”‚         â”‚ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”‚          â”‚ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”‚â€¢Auth    â”‚ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”‚â€¢Auth     â”‚ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”‚â€¢Users   â”‚ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”‚â€¢Users    â”‚ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”‚â€¢Items   â”‚ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”‚â€¢Items    â”‚ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â”‚â€¢Frontendâ”‚ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â”‚â€¢Frontend â”‚ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚                â”‚
                â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                â”‚
                â”‚          â”‚            â”‚         â”‚  â”‚           â”‚         â”‚                â”‚
                â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                â”‚
                â”‚          â”‚  â”‚ Private Subnet  â”‚ â”‚  â”‚ â”‚ Private Subnet   â”‚â”‚                â”‚
                â”‚          â”‚  â”‚  RDS            â”‚ â”‚  â”‚ â”‚  RDS             â”‚â”‚                â”‚
                â”‚          â”‚  â”‚  10.0.3.0/24    â”‚ â”‚  â”‚ â”‚  10.0.30.0/24    â”‚â”‚                â”‚
                â”‚          â”‚  â”‚                 â”‚ â”‚  â”‚ â”‚                  â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚ PostgreSQL  â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ PostgreSQL   â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â”‚  (Master)   â”‚â”€â”¼â”€â”¼â”€â”€â”¼â”€â”¼â”€â”‚  (Standby)   â”‚ â”‚â”‚ Multi-AZ       â”‚
                â”‚          â”‚  â”‚ â”‚db.t3.small  â”‚ â”‚ â”‚  â”‚ â”‚ â”‚ db.t3.small  â”‚ â”‚â”‚ [PROD only]    â”‚
                â”‚          â”‚  â”‚ â”‚   Port 5432 â”‚ â”‚ â”‚  â”‚ â”‚ â”‚   Port 5432  â”‚ â”‚â”‚                â”‚
                â”‚          â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚                â”‚
                â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                â”‚
                â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                â”‚                                                                              â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                â”‚  â”‚                         Amazon S3                                   â”‚    â”‚
                â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
                â”‚  â”‚  â”‚  â€¢ ALB Logs Bucket (7-90 jours retention)                    â”‚  â”‚    â”‚
                â”‚  â”‚  â”‚  â€¢ App Data Bucket (versioning activÃ© en PROD)               â”‚  â”‚    â”‚
                â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                â”‚                                                                              â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Groups

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Security Groups                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. ALB Security Group                                          â”‚
â”‚     â”œâ”€ Inbound:  80 (HTTP) from 0.0.0.0/0                       â”‚
â”‚     â”œâ”€ Inbound:  443 (HTTPS) from 0.0.0.0/0                     â”‚
â”‚     â””â”€ Outbound: All                                            â”‚
â”‚                                                                 â”‚
â”‚  2. EKS Cluster Security Group                                  â”‚
â”‚     â”œâ”€ Inbound:  443 from EKS Nodes SG                          â”‚
â”‚     â””â”€ Outbound: All                                            â”‚
â”‚                                                                 â”‚
â”‚  3. EKS Nodes Security Group                                    â”‚
â”‚     â”œâ”€ Inbound:  All from self                                  â”‚
â”‚     â”œâ”€ Inbound:  443 from EKS Cluster SG                        â”‚
â”‚     â”œâ”€ Inbound:  30000-32767 from ALB SG                        â”‚
â”‚     â”œâ”€ Inbound:  80, 443 from ALB SG                            â”‚
â”‚     â””â”€ Outbound: All                                            â”‚
â”‚                                                                 â”‚
â”‚  4. RDS Security Group                                          â”‚
â”‚     â”œâ”€ Inbound:  5432 (PostgreSQL) from EKS Nodes SG            â”‚
â”‚     â””â”€ Outbound: All                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Flow des requÃªtes

### RequÃªte API (exemple: POST /auth/api/v1/login)

```
1. User â†’ https://api.leotest.abrdns.com/auth/api/v1/login
          â”‚
          â–¼
2. Route53 â†’ RÃ©solution DNS â†’ ALB DNS
          â”‚
          â–¼
3. ALB â†’ Certificate Manager â†’ Validation SSL
          â”‚
          â–¼
4. ALB Listener 443 â†’ Target Group
          â”‚
          â–¼
5. Target Group â†’ EKS Node (10.0.2.x:30080)
          â”‚
          â–¼
6. Traefik Service (NodePort 30080)
          â”‚
          â–¼
7. Traefik Middleware â†’ Strip /auth prefix
          â”‚
          â–¼
8. Auth Service (ClusterIP platform-auth:80)
          â”‚
          â–¼
9. Auth Pod â†’ FastAPI â†’ /api/v1/login
          â”‚
          â–¼
10. RDS PostgreSQL (10.0.3.x:5432)
          â”‚
          â–¼
11. Response â† JWT Token
          â”‚
          â–¼
12. User â† 200 OK + Token
```

### RequÃªte Frontend (exemple: GET /)

```
1. User â†’ https://app.leotest.abrdns.com/
          â”‚
          â–¼
2. Route53 â†’ ALB
          â”‚
          â–¼
3. ALB â†’ Target Group â†’ Traefik
          â”‚
          â–¼
4. Frontend Service â†’ Next.js
          â”‚
          â–¼
5. User â† HTML/JS/CSS
```

## ğŸ“Š Composants dÃ©taillÃ©s

### VPC Configuration
```yaml
VPC:
  CIDR: 10.0.0.0/16
  DNS Hostnames: Enabled
  DNS Support: Enabled
  
Subnets:
  Public (ALB + NAT):
    - 10.0.1.0/24  (AZ-A)
    - 10.0.10.0/24 (AZ-B)
  
  Private EKS:
    - 10.0.2.0/24  (AZ-A)
    - 10.0.20.0/24 (AZ-B)
    Tags:
      - kubernetes.io/role/internal-elb: 1
      - kubernetes.io/cluster/[name]: shared
  
  Private RDS:
    - 10.0.3.0/24  (AZ-A)
    - 10.0.30.0/24 (AZ-B)

Internet Gateway: âœ…
NAT Gateways: 2 (un par AZ)
```

### EKS Configuration
```yaml
Cluster:
  Version: 1.28
  Endpoint: Public + Private
  OIDC Provider: Enabled (for IRSA)
  
Node Group:
  Instance Type: t3.medium
  Desired: 2 (dev) / 3 (prod)
  Min: 2
  Max: 3 (dev) / 6 (prod)
  Disk: 50GB gp3
  
Addons:
  - coredns
  - kube-proxy
  - vpc-cni
```

### RDS Configuration
```yaml
Engine: PostgreSQL 15.4
Instance: db.t3.small
Storage: 20GB (dev) / 50GB (prod) gp3
Multi-AZ: false (dev) / true (prod)
Backup: 1 day (dev) / 7 days (prod)
Encryption: Enabled
Enhanced Monitoring: Enabled
Port: 5432
```

### Load Balancer
```yaml
Type: Application Load Balancer
Scheme: internet-facing
IP Address Type: ipv4

Listeners:
  - Port 80:  HTTP â†’ Redirect to 443
  - Port 443: HTTPS â†’ Target Group (Traefik)

Target Group:
  Protocol: HTTP
  Port: 30080 (NodePort)
  Health Check: /ping
  Deregistration Delay: 30s
```

## ğŸ’° Estimation des coÃ»ts par composant

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Composant               â”‚   DEV    â”‚   PROD   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ EKS Control Plane       â”‚  $73/mo  â”‚  $73/mo  â”‚
â”‚ EC2 (t3.medium x2/3)    â”‚  $60/mo  â”‚  $90/mo  â”‚
â”‚ RDS (db.t3.small)       â”‚  $30/mo  â”‚  $60/mo  â”‚
â”‚ ALB                     â”‚  $20/mo  â”‚  $20/mo  â”‚
â”‚ NAT Gateway x2          â”‚  $65/mo  â”‚  $65/mo  â”‚
â”‚ Data Transfer           â”‚  $10/mo  â”‚  $20/mo  â”‚
â”‚ S3 Storage              â”‚   $2/mo  â”‚   $5/mo  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                   â”‚ ~$260/mo â”‚ ~$333/mo â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ High Availability (PROD)

```
âœ… Multi-AZ Deployment
  - 2 Availability Zones
  - Nodes rÃ©partis sur les 2 AZ
  - RDS Multi-AZ avec failover automatique
  
âœ… Load Balancing
  - ALB distribue le trafic
  - Traefik load balance entre les pods
  - RDS avec replica en standby
  
âœ… Auto Scaling
  - EKS Node Group peut scaler de 2 Ã  6 nodes
  - Pods peuvent scaler horizontalement
  
âœ… Backup & Recovery
  - RDS automated backups (7 jours)
  - S3 versioning activÃ©
  - Snapshots RDS avant destruction
```

## ğŸ”’ SÃ©curitÃ©

```
âœ… Network Security
  - Private subnets pour EKS et RDS
  - Security Groups restrictifs
  - NAT Gateway pour sortie internet
  
âœ… Encryption
  - SSL/TLS via Certificate Manager
  - RDS storage encrypted
  - S3 server-side encryption
  
âœ… IAM
  - RÃ´les IAM pour EKS
  - IRSA (IAM Roles for Service Accounts)
  - Least privilege principle
  
âœ… Monitoring
  - RDS Enhanced Monitoring
  - ALB Access Logs vers S3
  - CloudWatch metrics
```

---

**DerniÃ¨re mise Ã  jour**: 2025  
**Version**: 1.0.0
